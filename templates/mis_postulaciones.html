{% extends "layout.html" %}

{% block content %}
<div class="page-container">
    <header class="page-header">
        <h1>Seguimiento de Mis Postulaciones</h1>
        <p>Aquí puedes ver el estado de todas tus postulaciones activas.</p>
    </header>

    <div class="applications-list">
        <!-- BUCLE PARA MOSTRAR CADA POSTULACIÓN REAL -->
        {% for postulacion in postulaciones %}
        <div class="application-card">
            <div class="card-header">
                <div class="job-info">
                    <h2 class="job-title">{{ postulacion.oferta_empleo.titulo }}</h2>
                    <p class="company-name">en <a href="#">{{ postulacion.oferta_empleo.empresa.nombre_empresa }}</a></p>
                </div>
                <div class="application-date">
                    Postulaste el {{ postulacion.fecha_postulacion.strftime('%d de %b, %Y') }}
                </div>
            </div>
            <div class="card-body">
                <div class="status-tracker">
                    <!-- La clase 'active' se añade dinámicamente según el estado -->
                    <div class="status-step {% if postulacion.estado in ['Enviada', 'CV Visto', 'En Revisión', 'Entrevista', 'Contratado', 'Descartado'] %}active{% endif %}">
                        <div class="step-icon"><i class="fas fa-paper-plane"></i></div>
                        <span class="step-label">Enviada</span>
                    </div>
                    <div class="status-line"></div>
                    <div class="status-step {% if postulacion.estado in ['CV Visto', 'En Revisión', 'Entrevista', 'Contratado', 'Descartado'] %}active{% endif %}">
                        <div class="step-icon"><i class="fas fa-eye"></i></div>
                        <span class="step-label">CV Visto</span>
                    </div>
                    <div class="status-line"></div>
                    <div class="status-step {% if postulacion.estado in ['En Revisión', 'Entrevista', 'Contratado'] %}active{% endif %}">
                        <div class="step-icon"><i class="fas fa-users"></i></div>
                        <span class="step-label">En Proceso</span>
                    </div>
                    <div class="status-line"></div>
                    <div class="status-step {% if postulacion.estado in ['Contratado', 'Descartado'] %}active{% endif %}">
                        <div class="step-icon"><i class="fas fa-check-circle"></i></div>
                        <span class="step-label">Finalizado</span>
                    </div>
                </div>
                <!-- NUEVO: Mensaje de estado final -->
                {% if postulacion.estado == 'Contratado' %}
                    <p class="status-message success">¡Felicidades! Has sido seleccionado para este puesto.</p>
                {% elif postulacion.estado == 'Descartado' %}
                    <p class="status-message error">La empresa ha decidido continuar con otros candidatos en esta ocasión. ¡No te desanimes!</p>
                {% endif %}
            </div>
            <div class="card-footer">
                <a href="{{ url_for('oferta_detalle', oferta_id=postulacion.id_oferta) }}" class="btn btn-light-outline">Ver Oferta Original</a>
            </div>
        </div>
        {% else %}
        <div class="empty-state-card" style="text-align: center; padding: 40px;">
            <p>Aún no has postulado a ninguna oferta. ¡<a href="{{ url_for('busqueda_empleos') }}">Encuentra tu próximo desafío</a>!</p>
        </div>
        {% endfor %}
    </div>
</div>
{% endblock %}
