{% extends "layout.html" %}

{% block content %}
<div class="page-container">
    <header class="page-header">
        <h1>Editar Mi Perfil</h1>
        <p>Mantén tu información actualizada para atraer a las mejores empresas.</p>
    </header>

    <div class="edit-profile-container">
        <!-- Navegación por Pestañas -->
        <nav class="tabs-nav">
            <button class="tab-link active" data-tab="personal-info">Información Personal</button>
            <button class="tab-link" data-tab="experience">Experiencia</button>
            <button class="tab-link" data-tab="education">Educación</button>
            <button class="tab-link" data-tab="skills">Habilidades</button>
            <button class="tab-link" data-tab="projects">Proyectos</button>
        </nav>

        <!-- Contenido de las Pestañas -->
        <div class="tabs-content">
            <!-- Pestaña 1: Información Personal -->
            <div id="personal-info" class="tab-pane active">
                <form action="{{ url_for('editar_perfil') }}" method="POST" class="edit-form">
                    <div class="form-section-card">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="full-name">Nombre Completo</label>
                                <input type="text" id="full-name" name="nombre_completo" class="form-control" value="{{ current_user.perfil.nombre_completo or '' }}">
                            </div>
                            <div class="form-group">
                                <label for="job-title">Titular Profesional</label>
                                <input type="text" id="job-title" name="titular" class="form-control" value="{{ current_user.perfil.titular or '' }}">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="profile-picture-upload">Foto de Perfil</label>
                            <input type="file" id="profile-picture-upload" class="form-control-file">
                        </div>
                        <div class="form-group">
                            <label for="summary">Resumen Profesional</label>
                            <textarea id="summary" name="resumen" class="form-control" rows="5">{{ current_user.perfil.resumen or '' }}</textarea>
                        </div>
                    </div>
                    <div class="form-section-card">
                        <h3 class="form-section-title">Información de Contacto</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="email">Correo Electrónico</label>
                                <input type="email" id="email" class="form-control" value="{{ current_user.email or '' }}" readonly>
                                <small class="form-text">El correo electrónico no se puede cambiar.</small>
                            </div>
                            <div class="form-group">
                                <label for="phone">Teléfono</label>
                                <input type="tel" id="phone" name="telefono" class="form-control" value="{{ current_user.perfil.telefono or '' }}">
                            </div>
                        </div>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-dark-action">Guardar Cambios</button>
                    </div>
                </form>
                </form>
            </div>

            <!-- Pestaña 2: Experiencia -->
            <div id="experience" class="tab-pane">
                <div class="form-section-card">
                    <div class="items-list-header">
                        <h3>Tu Experiencia Laboral</h3>
                        <button type="button" class="btn btn-dark-action" data-modal-target="#add-experience-modal">
                            <i class="fas fa-plus"></i> Añadir Experiencia
                        </button>
                    </div>
                    <div class="items-list-container">
                        {% for exp in experiencias %}
                        <div class="editable-item">
                            <div class="item-info">
                                <h4 class="item-title">{{ exp.cargo }}</h4>
                                <p class="item-subtitle">{{ exp.empresa }}</p>
                            </div>
                            <div class="item-actions">
                                <button class="btn-icon" aria-label="Editar"><i class="fas fa-pencil-alt"></i></button>
                                <button class="btn-icon" aria-label="Eliminar"><i class="fas fa-trash-alt"></i></button>
                            </div>
                        </div>
                        {% else %}
                        <p>Aún no has añadido ninguna experiencia laboral.</p>
                        {% endfor %}
                    </div>
                </div>
            </div>

            <!-- Pestaña 3: Educación -->
            <div id="education" class="tab-pane">
                <div class="form-section-card">
                    <div class="items-list-header">
                        <h3>Tu Formación Académica</h3>
                        <button type="button" class="btn btn-dark-action" data-modal-target="#add-education-modal">
                            <i class="fas fa-plus"></i> Añadir Formación
                        </button>
                    </div>
                    <div class="items-list-container">
                        {% for edu in educacion %}
                        <div class="editable-item">
                            <div class="item-info">
                                <h4 class="item-title">{{ edu.titulo }}</h4>
                                <p class="item-subtitle">{{ edu.institucion }}</p>
                            </div>
                            <div class="item-actions">
                                <button class="btn-icon" aria-label="Editar"><i class="fas fa-pencil-alt"></i></button>
                                <button class="btn-icon" aria-label="Eliminar"><i class="fas fa-trash-alt"></i></button>
                            </div>
                        </div>
                        {% else %}
                        <p>Aún no has añadido ninguna formación académica.</p>
                        {% endfor %}
                    </div>
                </div>
            </div>
            
            <!-- Pestaña 4: Habilidades -->
            <div id="skills" class="tab-pane">
                <form action="{{ url_for('guardar_habilidades') }}" method="POST">
                    <div class="form-section-card">
                        <h3 class="form-section-title">Gestiona tus Habilidades</h3>
                        
                        <!-- Componente dinámico para Idiomas -->
                        <div class="form-group">
                            <label>Idiomas</label>
                            <div class="dynamic-add-container">
                                <input type="text" id="language-input" class="form-control" placeholder="Escribe un idioma (ej: Inglés)">
                                <button type="button" class="btn-add-item"><i class="fas fa-plus"></i> Añadir</button>
                            </div>
                            <div id="languages-list" class="dynamic-items-list">
                                <!-- Bucle para mostrar los idiomas ya guardados -->
                                {% for idioma_perfil in current_user.perfil.idiomas %}
                                <div class="dynamic-item">
                                    <span>{{ idioma_perfil.idioma.nombre }}</span>
                                    <div class="item-options">
                                        <select class="item-select" name="idioma_nivel_{{ idioma_perfil.idioma.nombre }}">
                                            <option {% if idioma_perfil.nivel == 'Nativo' %}selected{% endif %}>Nativo</option>
                                            <option {% if idioma_perfil.nivel == 'Avanzado' %}selected{% endif %}>Avanzado</option>
                                            <option {% if idioma_perfil.nivel == 'Intermedio' %}selected{% endif %}>Intermedio</option>
                                            <option {% if idioma_perfil.nivel == 'Básico' %}selected{% endif %}>Básico</option>
                                        </select>
                                        <button type="button" class="btn-remove-item">&times;</button>
                                    </div>
                                    <input type="hidden" name="idiomas" value="{{ idioma_perfil.idioma.nombre }}">
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                        
                        <hr class="form-divider">

                        <!-- Componente dinámico para Habilidades Técnicas -->
                        <div class="form-group">
                            <label>Habilidades Técnicas</label>
                            <div class="dynamic-add-container">
                                <input type="text" id="skill-input" class="form-control" placeholder="Escribe una habilidad (ej: Python)">
                                <button type="button" class="btn-add-item"><i class="fas fa-plus"></i> Añadir</button>
                            </div>
                            <div id="skills-list" class="dynamic-items-list">
                                <!-- Bucle para mostrar las habilidades ya guardadas -->
                                {% for habilidad_perfil in current_user.perfil.habilidades %}
                                <div class="dynamic-item">
                                    <span>{{ habilidad_perfil.habilidad.nombre }}</span>
                                    <div class="item-options">
                                        <button type="button" class="btn-remove-item">&times;</button>
                                    </div>
                                    <input type="hidden" name="habilidades" value="{{ habilidad_perfil.habilidad.nombre }}">
                                </div>
                                {% endfor %}
                            </div>
                        </div>

                        <div class="form-actions">
                            <button type="submit" class="btn btn-dark-action">Guardar Habilidades</button>
                        </div>
                    </div>
                </form>
            </div>

            <!-- Pestaña 5: Proyectos -->
            <div id="projects" class="tab-pane">
                <div class="form-section-card">
                    <div class="items-list-header">
                        <h3>Tus Proyectos Destacados</h3>
                        <button type="button" class="btn btn-dark-action" data-modal-target="#add-project-modal">
                            <i class="fas fa-plus"></i> Añadir Proyecto
                        </button>
                    </div>
                    <div class="items-list-container">
                        {% for proy in proyectos %}
                        <div class="editable-item">
                            <div class="item-info">
                                <h4 class="item-title">{{ proy.nombre_proyecto }}</h4>
                                <p class="item-subtitle">{{ proy.tecnologias }}</p>
                            </div>
                            <div class="item-actions">
                                <button class="btn-icon" aria-label="Editar"><i class="fas fa-pencil-alt"></i></button>
                                <button class="btn-icon" aria-label="Eliminar"><i class="fas fa-trash-alt"></i></button>
                            </div>
                        </div>
                        {% else %}
                        <p>Aún no has añadido ningún proyecto.</p>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
